{"title":"随笔-AI Agent的工具调用工程","uid":"21ea59c3cb5f2b5236c9677bdbbeba28","slug":"随笔/AI Agent的工具调用工程","date":"2026-02-02T11:47:09.000Z","updated":"2026-02-03T16:01:57.292Z","comments":true,"path":"api/articles/随笔/AI Agent的工具调用工程.json","keywords":null,"cover":"img/post/随笔/AI Agent的工具调用工程/cover.jpg","content":"<p><a href=\"%E9%9A%8F%E7%AC%94%2FAI%20Agent-%E9%9D%A2%E5%90%91LLM%E7%9A%84%E6%99%BA%E8%83%BD%E4%BB%A3%E7%90%86\">&lt;返回 AI Agent 目录</a></p>\n<hr />\n<h1 id=\"一-介绍\"><a class=\"markdownIt-Anchor\" href=\"#一-介绍\"></a> 一. 介绍</h1>\n<h2 id=\"1-工具提示词\"><a class=\"markdownIt-Anchor\" href=\"#1-工具提示词\"></a> 1. 工具提示词</h2>\n<p>工具提示词 (Tool Prompt) 是专门用于承载“工具执行结果”的消息类型。其核心作用就是把“工具调用的返回值”以结构化方式注入回模型上下文，让模型基于真实执行结果继续推理。</p>\n<p>Tool Message 不是模型生成的，而是由 Agent Runtime 构造的，内容来自于真实工具执行结果。</p>\n<p>完整的工具调用链通常是：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">UserMessage</span><br><span class=\"line\">↓</span><br><span class=\"line\">AssistantMessage (决定调用工具，产生 tool_call)</span><br><span class=\"line\">↓</span><br><span class=\"line\">[执行工具]</span><br><span class=\"line\">↓</span><br><span class=\"line\">ToolMessage (把执行结果喂回模型)</span><br><span class=\"line\">↓</span><br><span class=\"line\">AssistantMessage (基于结果继续回答或再调用工具)</span><br></pre></td></tr></table></figure>\n<p>记住再次打包发送时要将该 ToolMessage 放在触发它的 AssistantMessage 之后。</p>\n<p>在 OpenAI 的 api 接口中，其 JSON 形式通常如下：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;content&quot;</span><span class=\"punctuation\">:</span> string<span class=\"punctuation\">,</span>        <span class=\"comment\">// 工具提示词的具体内容</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;toolCallId&quot;</span><span class=\"punctuation\">:</span> string<span class=\"punctuation\">,</span>     <span class=\"comment\">// 此消息响应上一个 AssistantMessage 的 tool_call_id</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;role&quot;</span><span class=\"punctuation\">:</span> string            <span class=\"comment\">// 固定值 &quot;tool&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>相应的，在 request 中还需要包含 <code>list&lt;tools&gt;</code> 字段来定义可用的工具。对于 <code>tools</code> 字段，其 JSON 形式通常如下：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;id&quot;</span><span class=\"punctuation\">:</span> string<span class=\"punctuation\">,</span>      <span class=\"comment\">// 工具的描述</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> string<span class=\"punctuation\">,</span>    <span class=\"comment\">// 工具的类型，通常是 &quot;function&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;function&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span>      <span class=\"comment\">// 工具类</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;description&quot;</span><span class=\"punctuation\">:</span> string<span class=\"punctuation\">,</span>  <span class=\"comment\">// 工具的描述</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> string<span class=\"punctuation\">,</span>         <span class=\"comment\">// 工具的名称</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;arguments&quot;</span><span class=\"punctuation\">:</span> string<span class=\"punctuation\">,</span>    <span class=\"comment\">// 工具的输出参数，遵循 JSON Schema 规范</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;parameters&quot;</span><span class=\"punctuation\">:</span> object    <span class=\"comment\">// 工具的输入参数，遵循 JSON Schema 规范</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<hr />\n<h1 id=\"二-mcp-协议\"><a class=\"markdownIt-Anchor\" href=\"#二-mcp-协议\"></a> 二. MCP 协议</h1>\n<hr />\n<h1 id=\"三-分层空间\"><a class=\"markdownIt-Anchor\" href=\"#三-分层空间\"></a> 三. 分层空间</h1>\n<p>动态加载工具可能会破坏模型的 KV 缓存命中率，此外因为过去的上下文会保留工具调用历史，可能导致模型错误使用过时的工具。</p>\n<p>分层空间不再是让所有工具一股脑地丢给 LLM，而是给予模型自主创造工具的能力。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">层</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">函数调用层</td>\n<td>与 Agent 直接交互的唯一接口 <br> 只保留极少数、固定的原子性函数 <br> 例如读写文件、执行 shell 命令</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">沙盒工具</td>\n<td>让 Agent 主动发现和学习可以使用的工具<br> 例如执行 help 指令</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">包与API</td>\n<td>让 Agent 使用第一层的函数去自主编写并执行脚本</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<p><a href=\"%E9%9A%8F%E7%AC%94%2FAI%20Agent-%E9%9D%A2%E5%90%91LLM%E7%9A%84%E6%99%BA%E8%83%BD%E4%BB%A3%E7%90%86\">&lt;返回 AI Agent 目录</a></p>\n","feature":false,"text":"有关 AI Agent 的工具调用工程知识和思考，包含 MCP 技术。...","permalink":"/post/随笔/AI Agent的工具调用工程","photos":[],"count_time":{"symbolsCount":"1.4k","symbolsTime":"1 mins."},"categories":[{"name":"随笔-Agent","slug":"随笔-Agent","count":4,"path":"api/categories/随笔-Agent.json"}],"tags":[{"name":"LLM","slug":"LLM","count":4,"path":"api/tags/LLM.json"},{"name":"Agent","slug":"Agent","count":4,"path":"api/tags/Agent.json"},{"name":"Context Engineering","slug":"Context-Engineering","count":3,"path":"api/tags/Context-Engineering.json"},{"name":"Tool Calling","slug":"Tool-Calling","count":1,"path":"api/tags/Tool-Calling.json"},{"name":"Function Calling","slug":"Function-Calling","count":1,"path":"api/tags/Function-Calling.json"},{"name":"MCP","slug":"MCP","count":1,"path":"api/tags/MCP.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%B8%80-%E4%BB%8B%E7%BB%8D\"><span class=\"toc-text\"> 一. 介绍</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-%E5%B7%A5%E5%85%B7%E6%8F%90%E7%A4%BA%E8%AF%8D\"><span class=\"toc-text\"> 1. 工具提示词</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BA%8C-mcp-%E5%8D%8F%E8%AE%AE\"><span class=\"toc-text\"> 二. MCP 协议</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%B8%89-%E5%88%86%E5%B1%82%E7%A9%BA%E9%97%B4\"><span class=\"toc-text\"> 三. 分层空间</span></a></li></ol>","author":{"name":"zExNocs","slug":"blog-author","avatar":"/img/avatar.jpg","link":"/","description":"<p>一个喜欢摸鱼的人。<br>去码头整点薯条。</p>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"github":{"icon":"/img/svg/github.svg","link":"https://github.com/zExNocs"},"bilibili":{"icon":"/img/svg/bilibili.svg","link":"https://space.bilibili.com/13423200"},"steam":{"icon":"/img/svg/steam.svg","link":"https://steamcommunity.com/id/zExNocs/"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"运筹学和线性规划导航","uid":"57f63cc34b2f916074a1b8447b1cf916","slug":"笔记/线性规划/线性规划导航","date":"2025-12-29T09:14:00.000Z","updated":"2025-12-31T00:35:16.127Z","comments":true,"path":"api/articles/笔记/线性规划/线性规划导航.json","keywords":null,"cover":"img/post/笔记/线性规划/导航/cover.jpg","text":"关于线性规划的笔记。...","permalink":"/post/笔记/线性规划/线性规划导航","photos":[],"count_time":{"symbolsCount":"10k","symbolsTime":"9 mins."},"categories":[{"name":"导航","slug":"导航","count":8,"path":"api/categories/导航.json"}],"tags":[{"name":"Linear Programming","slug":"Linear-Programming","count":5,"path":"api/tags/Linear-Programming.json"},{"name":"Operations Research","slug":"Operations-Research","count":5,"path":"api/tags/Operations-Research.json"},{"name":"Optimization","slug":"Optimization","count":3,"path":"api/tags/Optimization.json"},{"name":"Product-Mix Optimization Problems","slug":"Product-Mix-Optimization-Problems","count":1,"path":"api/tags/Product-Mix-Optimization-Problems.json"}],"author":{"name":"zExNocs","slug":"blog-author","avatar":"/img/avatar.jpg","link":"/","description":"<p>一个喜欢摸鱼的人。<br>去码头整点薯条。</p>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"github":{"icon":"/img/svg/github.svg","link":"https://github.com/zExNocs"},"bilibili":{"icon":"/img/svg/bilibili.svg","link":"https://space.bilibili.com/13423200"},"steam":{"icon":"/img/svg/steam.svg","link":"https://steamcommunity.com/id/zExNocs/"}}}},"feature":true},"next_post":{"title":"随笔-AI Agent的检索工程","uid":"2dbcaf6d8ccd6aa6ce71937af4c45000","slug":"随笔/AI Agent的检索工程","date":"2026-02-02T06:02:27.000Z","updated":"2026-02-03T17:13:45.990Z","comments":true,"path":"api/articles/随笔/AI Agent的检索工程.json","keywords":null,"cover":"img/post/随笔/AI Agent的检索工程/cover.png","text":"有关 AI Agent 的检索工程知识和思考，包含 RAG、Skills 技术。...","permalink":"/post/随笔/AI Agent的检索工程","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[{"name":"随笔-Agent","slug":"随笔-Agent","count":4,"path":"api/categories/随笔-Agent.json"}],"tags":[{"name":"LLM","slug":"LLM","count":4,"path":"api/tags/LLM.json"},{"name":"Agent","slug":"Agent","count":4,"path":"api/tags/Agent.json"},{"name":"Context Engineering","slug":"Context-Engineering","count":3,"path":"api/tags/Context-Engineering.json"},{"name":"RAG","slug":"RAG","count":1,"path":"api/tags/RAG.json"},{"name":"Skills","slug":"Skills","count":1,"path":"api/tags/Skills.json"}],"author":{"name":"zExNocs","slug":"blog-author","avatar":"/img/avatar.jpg","link":"/","description":"<p>一个喜欢摸鱼的人。<br>去码头整点薯条。</p>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"github":{"icon":"/img/svg/github.svg","link":"https://github.com/zExNocs"},"bilibili":{"icon":"/img/svg/bilibili.svg","link":"https://space.bilibili.com/13423200"},"steam":{"icon":"/img/svg/steam.svg","link":"https://steamcommunity.com/id/zExNocs/"}}}},"feature":false}}